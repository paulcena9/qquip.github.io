rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /problems/{problemId} {
      // Only allow your Cloud Function to write
      allow create, update, delete: if false;

      // Tutors may only read their own problems
      allow read,update,delete: if request.auth != null
                  && request.auth.uid == resource.data.tutorId;
    }
    match /lessons/{lessonId} {
      // Allow a tutor to create a lesson where they are the tutor
      allow create: if request.auth.uid != null
                    && request.resource.data.tutorId == request.auth.uid;
      
      // Allow the tutor or the target student to read their lessons
      allow read: if request.auth.uid != null
                  && (request.auth.uid == resource.data.tutorId
                      || request.auth.uid == resource.data.studentId);
      
      // (Optional) allow updates/deletes by the tutor only
      allow update, delete: if request.auth.uid == resource.data.tutorId;
    }
  }
   
}